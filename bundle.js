(()=>{var e={487:()=>{const e=document.querySelector(".help"),t=document.querySelector(".help-text");e.addEventListener("click",(()=>{if(t.classList.contains("hidden"))return t.classList.remove("hidden"),t.classList.remove("help--fade-out"),void t.classList.add("help--appear");t.classList.remove("help--appear"),t.classList.add("help--fade-out")})),t.addEventListener("animationend",(function(){t.classList.contains("help--fade-out")&&t.classList.add("hidden")}))}},t={};function s(i){var a=t[i];if(void 0!==a)return a.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,s),o.exports}(()=>{"use strict";const e="left",t="right",i="up",a="down",o=[4,5,6,7],l=e=>e?JSON.parse(localStorage.getItem(e)):null,n=(e,t)=>{e&&t&&localStorage.setItem(e,JSON.stringify(t))};class r{constructor(e,t=null){this.gameField=e,this.metadata=t||{isWon:!1,isGameOver:!1,isPaused:!1,updatedScores:0,scores:0,best:0},this.tileContainer=document.querySelector(".tile-container"),this.bestScores=document.querySelector(".game-scores-best"),this.gameScores=document.querySelector(".game-scores"),this.bestScores.innerHTML=this.metadata.best,this.gameScores.firstChild.textContent=this.metadata.scores}createTile(e,t){const{value:s,isCombined:i,isNewCell:a}=this.gameField[e][t],o=document.createElement("div"),l=document.createElement("div");o.className=`tile ${this.positionClass(e,t)}`,l.className=`tile-inner tile--${s}`,l.innerHTML=s,a&&l.classList.add("tile--appear"),i&&l.classList.add("tile--combine"),o.appendChild(l),this.tileContainer.appendChild(o)}positionClass(e,t){return`tile-position-${t+1}-${e+1}`}updatePosition({x:e,y:t},s,i){const a=this.tileContainer.querySelectorAll(`.${this.positionClass(t,e)}`);return!a.length||e===i&&s===t||(a[0].classList.add(`${this.positionClass(s,i)}`),a[0].classList.remove(`${this.positionClass(t,e)}`)),a}isNotMoveable(){for(let e=0;e<this.gameField.length;e++)for(let t=0;t+1<this.gameField[e].length;t++)if(!this.gameField[e][t].value||!this.gameField[e][t+1].value||this.gameField[e][t].value===this.gameField[e][t+1].value||this.gameField[t][e].value===this.gameField[t+1][e].value)return!1;return!0}gameFinishing(){const e=document.querySelector(".game-message"),t=document.querySelector(".game-message-status");e.classList.remove("hidden"),t.innerHTML="Game Over!",t.style.color="#776e65",e.classList.add("game-message--game-over")}gameWinning(){const e=document.querySelector(".game-message-keep-playing"),t=document.querySelector(".game-message"),s=document.querySelector(".game-message-status");this.metadata.isPaused=!0,e.style.display="flex",s.innerHTML="You Win!",s.style.color="#fff",t.classList.remove("hidden"),t.classList.add("game-message--game-won"),e.addEventListener("click",(()=>{this.metadata.isPaused=!1,t.classList.remove("game-message--game-won"),t.classList.add("game-message--fade-out"),t.addEventListener("animationend",(()=>{t.classList.contains("game-message--fade-out")&&(e.style.display="none",t.classList.remove("game-message--fade-out"),t.classList.add("hidden"))}))}))}updateScores(){this.metadata.scores+=this.metadata.updatedScores;const e=document.createElement("div");e.classList.add("game-scores--addition"),this.gameScores.removeChild(this.gameScores.firstElementChild),this.metadata.best<this.metadata.scores&&(this.metadata.best=this.metadata.scores,this.bestScores.textContent=this.metadata.best),e.textContent=`+${this.metadata.updatedScores}`,this.gameScores.textContent=this.metadata.scores,this.gameScores.appendChild(e),this.metadata.updatedScores=0}combineTile(e,t,s){const{a:i,b:a}=e,o=this.gameField[t][s],l=this.updatePosition({x:i.x,y:i.y},t,s),n=this.updatePosition({x:a.x,y:a.y},t,s);o.isCombined&&this.createTile(t,s),[...l,...n].forEach((e=>e.classList.add("tile--fade-out")))}clearContainer(){[...this.tileContainer.children].forEach((e=>{e.firstChild.classList.remove("tile--appear"),e.firstChild.classList.remove("tile--combine"),e.classList.contains("tile--fade-out")&&this.tileContainer.removeChild(e)}))}render(t){let s=!1;const a=t===e||t===i;this.clearContainer();for(let e=a?0:this.gameField.length-1;a?e<this.gameField.length:e>=0;a?e++:e--)for(let t=a?0:this.gameField.length-1;a?t<this.gameField.length:t>=0;a?t++:t--){const{value:i,prevPosition:a,isCombined:o,isNewCell:l}=this.gameField[e][t];i&&(o?(2048!==i||this.metadata.isWon||(this.metadata.isWon=!0,this.gameWinning()),s=!0,this.metadata.updatedScores+=i,this.combineTile(a,e,t)):l?this.createTile(e,t):a&&this.updatePosition(a,e,t))}s&&this.updateScores(),this.isNotMoveable()&&(this.metadata.isGameOver=!0,this.gameFinishing())}drawField(){let e="";this.gameField.forEach((()=>{const t='<div class="game-cell"></div>'.repeat(this.gameField.length);e+=`<div class="game-row">${t}</div>`})),document.querySelector(".game-field").innerHTML=e}start(){for(;this.tileContainer.firstChild;)this.tileContainer.removeChild(this.tileContainer.firstChild);for(let e=0;e<this.gameField.length;e++)for(let t=0;t<this.gameField.length;t++){const{value:s}=this.gameField[e][t];s&&(this.gameField[e][t].isNewCell=!0,this.createTile(e,t))}this.metadata.isWon?this.gameWinning():this.metadata.isGameOver&&this.gameFinishing()}}class d{constructor(e=4,t=null){this.cells=e,this.gameField=t||this.createGameField(e)}createGameField(e){return Array.from({length:e},(()=>Array.from({length:e},(()=>({value:0,isCombined:!1,isNewCell:!1,prevPosition:null})))))}appendNum(){const e=Math.random()>.9?4:2,t=[];for(let e=0;e<this.cells;e++)for(let s=0;s<this.cells;s++)this.gameField[e][s].value||t.push([e,s]);if(t.length>0){const s=Math.floor(Math.random()*t.length),[i,a]=t[s];this.gameField[i][a].isNewCell=!0,this.gameField[i][a].value=e,this.gameField[i][a].prevPosition={x:a,y:i}}}getCells(s,o,l,n){const r=isNaN(n)?o:n,d={ref:null,position:{x:0,y:0}},c={ref:null,position:{x:0,y:0}};switch(s){case i:d.ref=this.gameField[r][l],c.ref=this.gameField[o+1][l],d.position={x:l,y:r},c.position={x:l,y:o+1};break;case a:d.ref=this.gameField[r][l],c.ref=this.gameField[o-1][l],d.position={x:l,y:r},c.position={x:l,y:o-1};break;case t:d.ref=this.gameField[l][r],c.ref=this.gameField[l][o-1],d.position={x:r,y:l},c.position={x:o-1,y:l};break;case e:d.ref=this.gameField[l][r],c.ref=this.gameField[l][o+1],d.position={x:r,y:l},c.position={x:o+1,y:l}}return[d,c]}moveAndCombine(t){const s=t===e||t===i;let a,o=s?0:this.cells-1,l=!1,n=!1;for(let e=o;s?e<this.cells:e>=0;s?e++:e--){a=o;for(let i=o;s?i+1<this.cells:i>0;s?i++:i--){let[r,d]=this.getCells(t,i,e,a);r.ref.value&&(s?a++:a--,r=this.getCells(t,i,e,a)[0]),!r.ref.value&&d.ref.value&&(r.ref.value=d.ref.value,r.ref.prevPosition=d.ref.prevPosition||d.position,r.ref.isCombined=d.ref.isCombined,d.ref.value=0,d.ref.prevPosition=null,d.ref.isNewCell=!1,d.ref.isCombined=!1,n=!0),(s?i+1>=this.cells-1:i-1<=0)&&this.combine(t,e)&&(l=!0,a=o,i=s?o-1:o+1)}}(n||l)&&this.appendNum()}combine(t,s){const a=t===e||t===i;let o=a?0:this.cells-1,l=!1;for(;a?o+1<this.cells:o>0;){const[e,i]=this.getCells(t,o,s);e.ref.value===i.ref.value&&e.ref.value&&i.ref.value&&!i.ref.isCombined&&!e.ref.isCombined&&(e.ref.value*=2,i.ref.value=0,e.ref.isCombined=!0,e.ref.prevPosition={a:e.ref.prevPosition||e.position,b:i.ref.prevPosition||i.position},i.ref.isNewCell=!1,l=!0),a?o++:o--}return l}resetProps(){for(let e=0;e<this.cells;e++)for(let t=0;t<this.cells;t++)this.gameField[e][t].isCombined=!1,this.gameField[e][t].isNewCell=!1,this.gameField[e][t].prevPosition=null}}let c,m;s(487);const h=(e,t)=>{const s=e||l("cells")||4;let[i=null,a={isWon:!1,isGameOver:!1,isPaused:!1,updatedScores:0,scores:0,best:0}]=l(`size${s}x${s}`)||[];t&&(a.scores=0,a.isGameOver=!1,a.isPaused=!1,a.isWon=!1,i=null),c=new d(s,i),m=new r(c.gameField,a),i&&i.length||(c.appendNum(),c.appendNum()),m.drawField(),m.start(),c.resetProps()},u=()=>{const e=c.cells;n(`size${e}x${e}`,[c.gameField,m.metadata])},g=(e,t=!1)=>{document.querySelector(".game-message").className="game-message hidden",u(),h(e,t)};h(),new class{constructor(e=4,t=function(){}){this.itemCallback=t,this.sizes=o,this.currentSize=o.find((t=>t===e)),this.dropdownContainer=document.querySelector(".dropdown")}setDropdownValue(e){this.currentSize=e,this.render()}toggleDropdown(e){e.currentTarget.classList.toggle("dropdown--open")}render(){const e=this.sizes.filter((e=>e!==this.currentSize)),t=this.currentSize,s=`\n      <div class="dropdown-wrapper">\n        <div class="dropdown-value" data-value="${t}">\n          ${t}x${t}\n        </div>\n          ${e.sort(((e,t)=>e-t)).map((e=>`<div class="dropdown-item" data-size="${e}">\n                ${e}x${e}\n              </div>`)).join(" ")}\n      </div>`;this.dropdownContainer.innerHTML=s,document.querySelector(".dropdown-wrapper").addEventListener("click",this.toggleDropdown.bind(this)),this.dropdownContainer.querySelectorAll(".dropdown-item").forEach((e=>{e.addEventListener("click",(e=>{const t=parseInt(e.target.getAttribute("data-size"),10);this.setDropdownValue(t),this.itemCallback(t)}))}))}}(c.cells,g).render();const p=e=>{m.metadata.isGameOver||m.metadata.isPaused||(c.moveAndCombine(e),m.render(e),c.resetProps())};((s=(()=>{}))=>{let o=0,l=0;document.addEventListener("touchstart",(e=>{o=e.touches[0].clientX,l=e.touches[0].clientY}),!1),document.addEventListener("touchmove",(n=>{if(!o||!l)return;const r=n.touches[0].clientX,d=n.touches[0].clientY,c=r-o,m=d-l;Math.abs(c)>Math.abs(m)?s(c>0?t:e):s(m>0?i:a),o=0,l=0}),!1)})(p),((s=(()=>{}))=>{document.addEventListener("keyup",(o=>{"ArrowDown"===o.key?s(a):"ArrowUp"===o.key?s(i):"ArrowRight"===o.key?s(t):"ArrowLeft"===o.key&&s(e)}))})(p),document.querySelector(".game-start").addEventListener("click",(()=>{g(c.cells,!0)})),window.addEventListener("beforeunload",(()=>{u(),n("cells",c.cells)})),document.querySelector(".game-message-retry").addEventListener("click",(()=>{g(c.cells,!0)})),document.addEventListener("click",(e=>{const t=document.querySelector(".dropdown-wrapper");!t.contains(e.target)&&t.classList.contains("dropdown--open")&&t.classList.remove("dropdown--open")}))})()})();